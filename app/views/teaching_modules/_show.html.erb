<div class="row">
  <div class="col-md-3">
    <div class="btn btn-block btn-default">
      <h2>Maquette <%= @teaching_module.planned_student_hours.round %></h2>
    </div>
  </div>
  <div class="col-md-3">
    <div class="btn btn-block btn-default">
      <h2>PPN <%= @teaching_module.expected_student_hours.round %></h2>
    </div>
  </div>
  <div class="col-md-6">
    <div class="btn btn-block btn-<%= @teaching_module.student_hours_delta < 0 ? 'danger' : 'success' %>">
      <h2>Delta <%= @teaching_module.student_hours_delta.round %>%</h2>
    </div>
  </div>
</div>

<hr/>

<h2>Heures</h2>
<div id="hours"></div></td>
<script type="text/javascript">
  $(function () {
    $('#hours').highcharts({
        chart: { type: 'bar', height: 150 },
        title: null,
        xAxis: { categories: ['PPN', 'Planifié'], tickWidth: 0 },
        yAxis: { min: 0, title: null },
        tooltip: { backgroundColor: 'white', valueSuffix: ' heures' },
        plotOptions: { series: { stacking: 'normal', dataLabels: { enabled: false } } },
        legend: { enabled: false },
        credits: { enabled: false },
        series: [
          { name: 'TP', data: [<%= @teaching_module.hours_tp %>, <%= @teaching_module.planned_student_hours_tp %>] }, 
          { name: 'TD', data: [<%= @teaching_module.hours_td %>, <%= @teaching_module.planned_student_hours_td %>] }, 
          { name: 'CM', data: [<%= @teaching_module.hours_cm %>, <%= @teaching_module.planned_student_hours_cm %>] }
          ]
    });
});
</script>
<%= link_to 'Planifier une personne', new_involvement_path(teaching_module_id: @teaching_module.id) %>
<table class="table">
  <thead>
    <tr>
      <th>Personne</th>
      <th>Heures étudiant total</th>
      <th>CM</th>
      <th>TD</th>
      <th>TP</th>
      <th>Heures enseignant</th>
      <th>Note</th>
      <th>Projet</th>
      <th>Edit</th>
    </tr>
  </thead>
  <tbody>
  <% @teaching_module.involvements.includes(:teaching_module).reorder('teaching_modules.semester_id').each do |involvement| %>
    <tr>
      <td><%= link_to involvement.user, involvement.user %></td>
      <td><%= involvement.student_hours %></td>
      <td><%= involvement.hours_cm %></td>
      <td><%= involvement.hours_td %> <span class="label label-default">x <%= involvement.multiplier_td %></span></td>
      <td><%= involvement.hours_tp %> <span class="label label-default">x <%= involvement.multiplier_tp %> / <%= involvement.groups_tp %></span></td>
      <td><%= involvement.teacher_hours %></td>
      <td style="max-width: 200px"><%= simple_format involvement.description %></td>
      <td><%= link_to involvement.project, involvement.project unless involvement.project.nil? %></td>
      <td><%= link_to 'Edit', edit_involvement_path(involvement), class: 'btn btn-primary btn-xs' %></td>
    </tr>
  <% end %>
  </tbody>
</table>

<div class="row">
  <div class="col-md-4">
    <h2>En bref</h2>
    <ul class="list">
      <li>Unité : <%= link_to @teaching_module.teaching_unit, @teaching_module.teaching_unit %></li>
      <li>Semestre : <%= link_to @teaching_module.semester, @teaching_module.semester %></li>
      <li>Semestre : Catégorie : <%= link_to @teaching_module.teaching_category, @teaching_module.teaching_category %></li>
      <li>Sujet : <%= link_to @teaching_module.teaching_subject, @teaching_module.teaching_subject %></li>
      <li>Durée : <%= @teaching_module.hours %> heures</li>
      <li>Coefficient : <%= @teaching_module.coefficient %></li>
      <% unless @teaching_module.user.nil? %>
        <li>Responsable : <%= link_to @teaching_module.user, @teaching_module.user %></li>
      <% end %>
    </ul>
  </div>
  <div class="col-md-4">
    <h2>Contenus</h2>
    <p><%= @teaching_module.content %></p>
  </div>  
  <div class="col-md-4">
    <h2>Objectifs</h2>
    <p>
      <ul>
        <% @teaching_module.objectives.each do |objective| %>
          <li><%= link_to objective, objective %></li>
        <% end %>
      </ul>
    </p>
  </div>
</div>
<div class="row">
  <div class="col-md-4">
    <h2>Modalités de mise en œuvre</h2>
    <p><%= @teaching_module.how_to %></p>
  </div>  
  <div class="col-md-4">
    <h2>Prolongements possibles</h2>
    <p><%= @teaching_module.what_next %></p>
  </div>  
  <div class="col-md-4">
    <h2>Mots-clés</h2>
    <%= render partial: 'keywords/inline_list', locals: {keywords: @teaching_module.keywords} %>
  </div>
</div>

<div class="row">
  <div class="col-md-6">
    <h2>Champs concernés</h2>
    <%= render partial: 'fields/inline_list', locals: {fields: @teaching_module.fields} %>
  </div>
  <div class="col-md-6">
    <h2>Projets possibles</h2>
    <%= render partial: 'projects/inline_list', locals: {projects: @teaching_module.projects} %>
  </div>
</div>
