<%= link_to 'Edit', edit_semester_path(@semester) %>
<p>Heures étudiant : <%= @semester.planned_student_hours.round %> planifiées / <%= @semester.expected_student_hours.round %> PPN</p>
<div id="semester-<%= @semester.id %>"></div></td>
<script type="text/javascript">
  $(function () {
    $('#semester-<%= @semester.id %>').highcharts({
        chart: { type: 'bar', height: 150 },
        title: null,
        xAxis: { categories: ['PPN', 'Planifié'], tickWidth: 0 },
        yAxis: { min: 0, title: null },
        tooltip: { backgroundColor: 'white', valueSuffix: ' heures' },
        plotOptions: { series: { stacking: 'normal', dataLabels: { enabled: false } } },
        legend: { enabled: false },
        credits: { enabled: false },
        series: [
          { name: 'TP', data: [<%= @semester.student_hours_tp %>, <%= @semester.planned_student_hours_tp %>] }, 
          { name: 'TD', data: [<%= @semester.student_hours_td %>, <%= @semester.planned_student_hours_td %>] }, 
          { name: 'CM', data: [<%= @semester.student_hours_cm %>, <%= @semester.planned_student_hours_cm %>] }
          ]
    });
});
</script>

<h3><%= @semester.teaching_modules.count %> modules</h3>

<table class="table table-hover">
  <thead>
    <tr>
      <th>Nom</th>
      <th>Heures étudiant: Planifié / PPN</th>
      <th>Variation</th>
      <th>Récapitulatif</th>
      <th>Détail</th>
    </tr>
  </thead>
  <tbody>
    <% @semester.teaching_modules.each do |teaching_module| %>
      <tr>
        <td><%= link_to teaching_module.full_name, teaching_module %></td>
        <td><%= teaching_module.planned_student_hours.round %> / <%= teaching_module.expected_student_hours.round %></td>
        <td class=" <%= 'hours-above' if teaching_module.student_hours_above_threshold? %>
                    <%= 'hours-below' if teaching_module.student_hours_below_threshold? %>">
          <%= teaching_module.student_hours_delta.round %> %
        </td>
        <td width="300" style="padding: 0"><div id="summary-<%= teaching_module.id %>"></div></td>
        <script type="text/javascript">
          $(function () {
            $('#summary-<%= teaching_module.id %>').highcharts({
                chart: { type: 'bar', height: 80 },
                title: null,
                xAxis: { categories: ['PPN', 'Planifié'], tickWidth: 0 },
                yAxis: { min: 0, max: 60, title: null, gridLineWidth: 0, labels: { enabled: false } },
                tooltip: { backgroundColor: 'white', valueSuffix: ' heures' },
                plotOptions: { series: { stacking: 'normal', dataLabels: { enabled: false } } },
                legend: { enabled: false },
                credits: { enabled: false },
                series: [
                  { name: 'TP', data: [<%= teaching_module.hours_tp %>, <%= teaching_module.planned_student_hours_tp %>] }, 
                  { name: 'TD', data: [<%= teaching_module.hours_td %>, <%= teaching_module.planned_student_hours_td %>] }, 
                  { name: 'CM', data: [<%= teaching_module.hours_cm %>, <%= teaching_module.planned_student_hours_cm %>] }
                  ]
            });
        });
        </script>
        <td>
          <a data-toggle="collapse" data-target="#collapse<%= teaching_module.id %>" class="btn btn-default btn-xs">+</a>
          <div id="collapse<%= teaching_module.id %>" class="collapse">
            <% teaching_module.involvements.each do |involvement| %>
              <%= involvement.user %>
              CM <%= involvement.hours_cm %>
              TD <%= involvement.hours_td %>
              TP <%= involvement.hours_tp %>
              <%= "(#{involvement.description})" unless involvement.description.nil? or involvement.description.empty? %>
              <br/>
            <% end %>
          </div>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
